<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Juego de campo de minas</title>
  <style>
    body {
      margin: auto;
      padding: 1rem;
    }

    table {
      border-collapse: collapse;
      margin-top: 20px;
    }

    td {
      width: 30px;
      height: 30px;
      padding: 5px;
      text-align: center;
      vertical-align: middle;
      background-color: #aaa;
      cursor: pointer;
      border: 1px solid #ccc;
    }

    img {
      max-width: 100%;
      max-height: 100%;
    }

    .bomb-cell {
      background-color: #df6a6a; /* Change the background color for cells with bombs */
    }
  </style>
</head>
<body>

<script>
'use strict';

let field = []; // Debes inicializar field como un array bidimensional
let tile = 0;
let tilesMarked=0;

//TMP:
function gameOver() {
  // Reveal all bomb cells
  for (let i = 0; i < field.length; i++) {
    for (let j = 0; j < field[i].length; j++) {
      const cell = field[i][j];
      if (field[i][j] === "b") {
        const cell = document.getElementById(`cell-${i}-${j}`);
        const bombImage = document.createElement('img');
        bombImage.src = 'assets/img/b0b.png';
        bombImage.alt = 'bomb';
        cell.innerHTML = '';  // Clear the cell content
        cell.classList.add('bomb-cell');
        cell.appendChild(bombImage);
      }
    }
  }
}
//TMP:
function revealCell(row, col) {
  // Obtener la celda
  const cell = document.getElementById(`cell-${row}-${col}`);
  // Mostrar el contenido de la celda en la casilla
  
  if (field[row][col] === "b") {
    const bombImage = document.createElement('img');
    bombImage.src = 'assets/img/b0b.png';
    bombImage.alt = 'bomb';
    cell.innerHTML = '';  // Clear the cell content
    cell.classList.add('bomb-cell');
    cell.appendChild(bombImage);
    gameOver();
  }
  else {
    if (field[row][col] > 0) {
      cell.textContent = field[row][col];
      cell.style.backgroundColor = '#888';
    }
    else {
      cell.style.backgroundColor = '#888';
      const numRows = field.length;
      const numCols = field[0].length;
      
      for (let i = row - 1; i <= row + 1; i++) {
  for (let j = col - 1; j <= col + 1; j++) {
    // Verificar si la casilla está dentro de los límites del campo
    if (i >= 0 && i < numRows && j >= 0 && j < numCols) {
      const neighborCell = document.getElementById(`cell-${i}-${j}`);
      // Verificar si la casilla no ha sido revelada aún
      if (!neighborCell.classList.contains('revealed')) {
        revealCell(i, j);
      }
    }
  }
}
cell.classList.add('revealed');

    }
  }
}
//FIXME:
function markCell(event, row, col) {

  // Evitar el menú contextual predeterminado
  event.preventDefault();
  // Obtener la celda
  const cell = document.getElementById(`cell-${row}-${col}`);

  if (tilesMarked<numberBomb(field)) {
    if (!cell.classList.contains('marked')) {
      cell.style.backgroundColor = 'yellow';
      cell.classList.add('marked');
      tilesMarked++;
    }
    else {
      cell.style.backgroundColor = '#aaa';
      cell.classList.remove('marked');
      tilesMarked--;
    }
    
  }
  // Marcar la celda (puedes cambiar esto según tus necesidades)
  
}

function numberBomb(array) {
  if (Array.isArray(array)) {
    let bc = 0;
    for (let i = 0; i < array.length; i++) {
      for (let j = 0; j < array[i].length; j++) {
        if (array[i][j] === "b") {
          bc++;
        }
      }
    }
    return bc;
  } else {
    return 'error';
  }
}

function crearTabla(array) {
  var contenedorTabla = document.body;
  var tabla = document.createElement('table');
  var tbody = document.createElement('tbody');

  array.forEach(function (filaDatos, rowIndex) {
    var fila = tbody.insertRow();

    filaDatos.forEach(function (dato, colIndex) {
      var celda = fila.insertCell();
      celda.textContent = " ";
      celda.id = `cell-${rowIndex}-${colIndex}`; // Agrega un identificador único a cada celda

      // Agregar evento de clic a cada celda
      celda.addEventListener('click', function() {
        revealCell(rowIndex, colIndex);
      });

      // Agregar evento de clic derecho a cada celda
      celda.addEventListener('contextmenu', function(event) {
        markCell(event, rowIndex, colIndex);
        });
    });
  });

  tabla.appendChild(tbody);
  contenedorTabla.appendChild(tabla);
}

function countAdjacentBombs(array, row, col) {
  const numRows = field.length;
  const numCols = field[0].length;
  let bombCount = 0;

  for (let i = row - 1; i <= row + 1; i++) {
    for (let j = col - 1; j <= col + 1; j++) {
      // Verificar si la casilla está dentro de los límites del campo
      if (i >= 0 && i < numRows && j >= 0 && j < numCols) {
        // Verificar si la casilla contiene una bomba
        if (field[i][j] === "b") {
          bombCount++;
        }
      }
    }
  }

  // Restar 1 si la casilla actual también contiene una bomba
  if (field[row][col] === "b") {
    bombCount--;
  }

  return bombCount;
}

function easy() {
  for (let i = 0; i < 6; i++) {
    field[i] = []; // Inicializa cada fila como un array
    const b = 12;
    for (let j = 0; j < 6; j++) {
      const rand = getRandomInt(6);
      if (rand === 5) {
        field[i][j] = "b";
      } else {
        field[i][j] = 0;
      }
      tile++;
    }
    if (numberBomb(field) >= b) {
      break;
    }
  }
  for (let i = 0; i < field.length; i++) {
    for (let j = 0; j < field[i].length; j++) {
      if (field[i][j] !== "b") {
        field[i][j] = countAdjacentBombs(field, i, j);
      }
    }
  }
}

function game() {
  
  

  crearTabla(field);
}

function getRandomInt(max) {
  return Math.floor(Math.random() * Math.floor(max));
}

easy();
game();
</script>

</body>
</html>
